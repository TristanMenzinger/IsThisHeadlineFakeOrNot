<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<style>
    html, body {
        margin: 0px;
        padding: 0px;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .card {
        position: absolute;

        margin: auto;
        left: 0;
        right: 0;

        height: calc(100% - 3em);
        width: 80%;
        max-width: 400px;
    }
    .card.smooth {
        transition: 1s ease-in-out;
    }
    .card.hide {
        display: none;
    }

    .card.smooth > .overlay {
        transition: 0.5s ease-in-out;
    }
    .overlay {
        text-align: center;
        justify-content: center;
        font-size: 50pt;
        font-weight: 600;
        color: white;
        opacity: 0;

        height: 100%;
        width: 100%;
        margin-top: -20px;
    }
    .card.overlay.overlay-left {
        background-color: red;
    }
    .card.overlay.overlay-right {
        background-color: green;
    }

    body {
        display: flex;
        justify-content: center;
    }

    #container-wrapper {
        display: flex;
        flex-direction: column;
        align-self: center;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
    }
    .rel-max-wrapper {
        position: relative;
        height: 100%;
        width: 100%;
    }

    /* Styling */
    .headline {
        flex-grow: 0;
        flex-shrink: 0;
        flex-basis: 40%;
        padding: 20px;
        overflow: none;
        /*transition: box-shadow 0.3s ease-in-out;*/
    }
    .headline:hover.shadow-lg{
        /*box-shadow: 0 1rem 3rem rgba(0,0,0,0.3)!important;*/
        /*transition: box-shadow 0.3s ease-in-out;*/
    }
    .headline .card-text {
        max-height: 90%;
        overflow: hidden;

        font-size: 20pt;
        font-family: Helvetica, Roboto, Arial;
        font-weight: 700;
    }
    .headline .card-buttons button {
        padding-left: 0px;
        line-height: 12px;
        text-decoration: underline;
    }

    .headline .placeholder {
        margin-left: auto;
        width: 1px;
    }
    .headline .btn-link {
        color: darkgray;
        padding: 10;
    } 

    .break {
        flex-basis: 100%;
        height: 0;
    }

    #info-done {
        position: absolute;

        width: 100%;
        height: 100%;

        display: flex;
        flex-direction: column;

        align-items: center;
        justify-content: center;
    }
    #info-done > span {
        display: flex;
        align-items: baseline;
        flex-direction: row;
    }
    #info-done > span > * {
        margin-right: 5px;
    }

    #container-title {
        align-self: center;
        padding: 2em;
        padding-left: 3em;
        padding-bottom: 2em;

        width: 100%;
        max-width: 500px;
    }
    #container-title h1 {
        font-weight: 700;
    }
    #container-title > *:not(:first-child) {
        margin-top: -15px;
    }
    #container-title span.red {
        text-decoration: underline;
        text-decoration-color: red;
    }
    #container-title span.green {
        text-decoration: underline;
        text-decoration-color: green;
    }

</style>

<body>
    <div id="info-done">
        <h1>All done.</h1>
        <span>
            <h6>You got</h6>
            <h5>3 / 10</h5>
            <h6>right.</h6>
        </span>
    </div>
    <div id="container-wrapper">
        <div id="container-title">
            <h4>Is this Headline</h4>
            <h1><span class="red">fake</span> or <span class="green">not</span>?</h1>
        </div>
        <div id="container-headlines" class="rel-max-wrapper">
        </div>
    </div>
    <script type="text/javascript">
    class Card {
        constructor(title, settings) {
            this.title = title;

            this._create_div()

            this.overlay_left = this.div.querySelector(".overlay-left");
            this.overlay_right = this.div.querySelector(".overlay-right");

            settings = settings ? settings : {};
            this.threshold_go = settings["threshold_go"] ? settings["threshold_go"] : 0.6
            this.overlay_multiplier = settings["overlay_multiplier"] ? settings["overlay_multiplier"] : 2
            this.fade_multiplier = settings["fade_multiplier"] ? settings["fade_multiplier"] : 0.8

            this.initial_rotation = (Math.random() - 0.5) * 5;
            this.initial_x_offset = (Math.random() - 0.5) * 5;
            this.initial_y_offset = (Math.random() - 0.5) * 5;

            this.div.style.transform = `translateX(${this.initial_x_offset}px) translateY(${this.initial_y_offset}px) rotate(${this.initial_rotation}deg)`

            this.gone = false;

        }

        _create_div() {
            let template = `
                <div class="card swipe-card headline">
                    <div class="card overlay overlay-left">Fake</div>
                    <div class="card overlay overlay-right">Real</div>
                    <div class="card-body">
                        <!-- <h5 class="card-title">Special title treatment</h5> -->
                        <p class="card-text">${this.title}</p>
                        <div class="break"></div>
                        <div class="card-buttons">
                            <button type="button" class="btn btn-link x">Report</button>
                            <button type="button" class="btn btn-link x">Too Easy</button>
                        </div>
                    </div>
                </div>`
            this.div = div_from_template(template);
        }

        activate() {
            this.div.ontouchstart = () => {
                this.div.classList.remove("smooth");
                this.start_x = event.touches[0].clientX
                this.start_y = event.touches[0].clientY
            }
            this.div.ontouchmove = (event) => {
                const percentage_progress = (event.touches[0].clientX - this.start_x) / this.div.getBoundingClientRect().width;
                if (Math.abs(percentage_progress) < this.threshold_go)
                    this.animate_progress(percentage_progress);
                else
                    this.go(percentage_progress / Math.abs(percentage_progress));
            }
            this.div.ontouchend = () => {
                if (!this.gone)
                    this.comeback();
            }


            let drag = false;
            this.div.onmousedown = (event) => {
                drag = true;
                this.div.classList.remove("smooth");
                this.start_x = event.clientX
                this.start_y = event.clientY
            }
            this.div.onmousemove = (event) => {
                if (drag) {
                    const percentage_progress = (event.clientX - this.start_x) / this.div.getBoundingClientRect().width;
                    if (Math.abs(percentage_progress) < this.threshold_go)
                        this.animate_progress(percentage_progress);
                    else
                        this.go(percentage_progress / Math.abs(percentage_progress));
                }
            }
            this.div.onmouseup = () => {
                drag = false;
                this.div.ontouchend();
            }
        }

        deactivate() {
            this.div.ontouchstart = () => {}
            this.div.ontouchmove = () => {}
            this.div.ontouchend = () => {}
        }


        animate_progress(percentage_progress) {
            const x_transform = this.initial_x_offset + percentage_progress * this.div.getBoundingClientRect().width;
            const rotation = this.initial_rotation + 10 * percentage_progress;

            this.div.style.opacity = 1 - sigmoid((Math.abs(this.fade_multiplier * percentage_progress) - 0.75) * 10);
            this.div.style.transform = `translateX(${x_transform}px) translateY(${this.initial_y_offset}px) rotate(${rotation}deg)`

            const opacity = sigmoid((Math.abs(this.overlay_multiplier * percentage_progress) - 0.5) * 10);
            console.log(opacity)
            if (percentage_progress < 0) {
                this.overlay_left.style.opacity = opacity;
            } else {
                this.overlay_right.style.opacity = opacity;
            }

        }

        comeback() {
            this.div.classList.add("smooth");

            this.overlay_left.style.opacity = 0;
            this.overlay_right.style.opacity = 0;

            this.div.style.opacity = 1;
            this.div.style.transform = `translateX(${this.initial_x_offset}px) translateY(${this.initial_y_offset}px) rotate(${this.initial_rotation}deg)`
        }

        go(direction) {
            if (!this.gone) {
                this.gone = true;
                this.div.classList.add("smooth");
                this.animate_progress(direction * 2);
                setTimeout(() => {
                    this.div.classList.add("hide");
                }, 1000);
                if (this.stack)
                    this.stack.next()
            }
        }
    }

    class Stack {
        constructor(cards) {
            this.cards = cards;
            for (let card of cards) {
                card.stack = this;
            }

            this.index = this.cards.length - 1;
            this.current = this.cards[this.index];
            this.current.activate();
        }

        next() {
            this.index = this.index - 1;
            this.current = this.cards[this.index];
            console.log(this.index)
            this.current.activate();
        }
    }

    let div_from_template = (filled_template_string) => {
        let wrapper = document.createElement("div");
        wrapper.innerHTML = filled_template_string;
        return wrapper.firstElementChild;
    }

    function sigmoid(t) {
        return 1 / (1 + Math.exp(-t));
    }

    let headlines = [
        `Stroll Into The Heart Of Thanksgiving | FloCombat`,
        `The Easiest Slut-shaming Tax Ways To Get Rid Of The Smugness`,
        `"Donald Trump Rules With Gun, Kisses To Netanyahu, Knocks Young Toddlers Down In Chanticleer Square, Got Her The Plates"`,
        `Myths About One In Five Millennials Believes In UFOs`,
        `The Best Stone Fence You'll Ever Built`,
        `Ed Helms' Last Trip To Davos (PHOTOS)`,
        `Cowboys Bus Driver Misses Patients At Thanksgiving`,
        `"Forget About The Cookies: The Superbowl Superjam Is Exactly What You Need To Celebrate A Spicy Thanksgiving Weekend"`,
        `Ryan Lochte's Malicious Dangling Harness Of Braveness Will Put Your Gag Reflexes at Risk`,
        `Draymond Green Is Dating A Wound Where is It?`,
        `Lisa Joy Joins Chris Pratt In 'Raising Hope'`,
        `5 Simple Ways to Tell Your Mom You're in Love`,
        `Kimmie Jenner's Storm Arc In 'Keeping Up With the Kardashians' Was One Of The Finest Moments In The Show`,
        `Twilight Angel Joy Staiger Falls Off 'Cuddle Divas' For First Time Since 2013`,
        `My Life As A Grad Student: Calhoun, Milton, Jefferson & Florida`,
        `WATCH: Claire Danes And Emma Stone Share A Classic Bridal Dress`,
        `Katie Couric Tied Up, Levered Into The Cab Of A Car`,
    ];

    cards = []
    for (let headline of headlines) {
        cards.push(new Card(headline));
    }  

    container = document.querySelector("#container-headlines");
    for (let card of cards) {
        container.appendChild(card.div);
    }
    new Stack(cards);
    </script>
</body>

</html>